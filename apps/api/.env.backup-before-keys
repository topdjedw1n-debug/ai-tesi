# ============================================================================
# TesiGo Backend API Environment Variables
# ============================================================================
# This file contains environment variables for FastAPI backend.
# NEVER commit this file to Git - it's already in .gitignore
#
# Created: 2025-12-03
# Purpose: Backend configuration for local development
# ============================================================================

# ----------------------------------------------------------------------------
# Database Configuration
# ----------------------------------------------------------------------------
# PostgreSQL connection for local development
DATABASE_URL=postgresql+asyncpg://postgres:password@localhost:5432/ai_thesis_platform

# Database pool settings (asyncpg)
DB_POOL_SIZE=20
DB_MAX_OVERFLOW=0
DB_POOL_TIMEOUT=30
DB_POOL_RECYCLE=3600

# ----------------------------------------------------------------------------
# Security & Authentication
# ----------------------------------------------------------------------------
# IMPORTANT: Generate strong random keys for production!
# Generate with: openssl rand -hex 32
SECRET_KEY=dev-secret-key-change-in-production-min-32-chars-long-1234567890
JWT_SECRET=dev-jwt-key-for-testing-min-32-chars-long-abcdef1234567890xyz
JWT_ALGORITHM=HS256
JWT_EXPIRATION=3600

# Admin credentials (for admin panel)
ADMIN_EMAIL=admin@tesigo.com
ADMIN_PASSWORD=changeme_in_production

# ----------------------------------------------------------------------------
# AI API Keys (OpenAI) - REQUIRED for AI generation
# ----------------------------------------------------------------------------
# Get your key at: https://platform.openai.com/api-keys
# Format: sk-proj-...
OPENAI_API_KEY=sk-proj-your-openai-api-key-here
OPENAI_ORG_ID=org-your-organization-id-optional

# ----------------------------------------------------------------------------
# AI API Keys (Anthropic Claude) - REQUIRED for AI generation
# ----------------------------------------------------------------------------
# Get your key at: https://console.anthropic.com/settings/keys
# Format: sk-ant-...
ANTHROPIC_API_KEY=sk-ant-your-anthropic-api-key-here

# ----------------------------------------------------------------------------
# Search & RAG APIs - REQUIRED for content research
# ----------------------------------------------------------------------------
# Tavily API for web search and RAG
# Get your key at: https://tavily.com/
TAVILY_API_KEY=tvly-your-tavily-api-key-here

# Perplexity API for real-time search (optional)
# Get your key at: https://www.perplexity.ai/
PERPLEXITY_API_KEY=pplx-your-perplexity-api-key-here

# Serper API for Google search (optional)
# Get your key at: https://serper.dev/
SERPER_API_KEY=your-serper-api-key-here

# Semantic Scholar API (no key required, but rate limited)
SEMANTIC_SCHOLAR_API_KEY=optional-for-higher-rate-limits

# ----------------------------------------------------------------------------
# Quality Check APIs
# ----------------------------------------------------------------------------
# GPTZero for AI detection
GPTZERO_API_KEY=your-gptzero-api-key-here

# Originality.AI for AI detection
ORIGINALITY_AI_API_KEY=your-originality-api-key-here

# LanguageTool for grammar checking
LANGUAGETOOL_API_URL=https://api.languagetool.org/v2
LANGUAGETOOL_API_KEY=your-languagetool-api-key-optional

# Copyscape for plagiarism detection
COPYSCAPE_API_KEY=your-copyscape-api-key-here
COPYSCAPE_USERNAME=your-copyscape-username-here

# ----------------------------------------------------------------------------
# Storage Configuration (MinIO)
# ----------------------------------------------------------------------------
MINIO_ENDPOINT=localhost:9000
MINIO_ACCESS_KEY=minioadmin
MINIO_SECRET_KEY=minioadmin
MINIO_BUCKET=tesigo-documents
MINIO_USE_SSL=false

# ----------------------------------------------------------------------------
# Redis Configuration
# ----------------------------------------------------------------------------
REDIS_URL=redis://localhost:6379/0
REDIS_CACHE_TTL=3600

# ----------------------------------------------------------------------------
# Payment Configuration (Stripe)
# ----------------------------------------------------------------------------
# Get keys at: https://dashboard.stripe.com/apikeys
STRIPE_SECRET_KEY=sk_test_your-stripe-secret-key
STRIPE_PUBLISHABLE_KEY=pk_test_your-stripe-publishable-key
STRIPE_WEBHOOK_SECRET=whsec_your-webhook-secret

# Pricing (per page in EUR cents)
PRICE_PER_PAGE=50
MIN_PAGES=3
MAX_PAGES=200
CURRENCY=EUR

# ----------------------------------------------------------------------------
# Email Configuration (Magic Link Authentication)
# ----------------------------------------------------------------------------
# SMTP settings for sending magic links
SMTP_HOST=smtp.gmail.com
SMTP_PORT=587
SMTP_USER=your-email@gmail.com
SMTP_PASSWORD=your-app-password
SMTP_FROM=noreply@tesigo.com

# Email templates
MAGIC_LINK_EXPIRATION=900
MAGIC_LINK_BASE_URL=http://localhost:3000

# ----------------------------------------------------------------------------
# AI Configuration (Retry & Fallback)
# ----------------------------------------------------------------------------
# Retry settings (Task 3.1)
AI_MAX_RETRIES=3
AI_RETRY_DELAYS=2,4,8
AI_ENABLE_FALLBACK=true

# Fallback chain: comma-separated "provider:model" pairs
# Tried in order: GPT-4 → GPT-3.5 Turbo → Claude 3.5 Sonnet
AI_FALLBACK_CHAIN=openai:gpt-4,openai:gpt-3.5-turbo,anthropic:claude-3-5-sonnet-20241022

# Model timeouts (seconds)
AI_REQUEST_TIMEOUT=120
AI_STREAM_TIMEOUT=300

# ----------------------------------------------------------------------------
# Quality Gates Configuration (Task 3.2)
# ----------------------------------------------------------------------------
# Grammar threshold: max errors before regeneration
QUALITY_MAX_GRAMMAR_ERRORS=10

# Plagiarism threshold: min uniqueness % required (85 = 15% plagiarism allowed)
QUALITY_MIN_PLAGIARISM_UNIQUENESS=85.0

# AI detection threshold: max AI-generated % before multi-pass humanization
QUALITY_MAX_AI_DETECTION_SCORE=55.0

# Max regeneration attempts per section if quality fails
QUALITY_MAX_REGENERATE_ATTEMPTS=2

# Enable/disable quality gates
QUALITY_GATES_ENABLED=true

# Context limit: max previous sections in context to prevent token explosion
QUALITY_GATES_MAX_CONTEXT_SECTIONS=10

# Enable individual quality checks
AI_DETECTION_ENABLED=true
LANGUAGETOOL_ENABLED=true
PLAGIARISM_CHECK_ENABLED=true

# ----------------------------------------------------------------------------
# Rate Limiting
# ----------------------------------------------------------------------------
RATE_LIMIT_PER_MINUTE=60
RATE_LIMIT_AUTH_LOCKOUT_THRESHOLD=5
DISABLE_RATE_LIMIT=false

# ----------------------------------------------------------------------------
# CORS Configuration
# ----------------------------------------------------------------------------
CORS_ALLOWED_ORIGINS=http://localhost:3000,http://localhost:8000
CORS_ALLOW_CREDENTIALS=true

# ----------------------------------------------------------------------------
# Logging & Monitoring
# ----------------------------------------------------------------------------
LOG_LEVEL=INFO
LOG_FORMAT=json

# Sentry for error tracking (optional)
# SENTRY_DSN=
SENTRY_ENVIRONMENT=development

# Prometheus metrics (optional)
PROMETHEUS_ENABLED=false
PROMETHEUS_PORT=9090

# ----------------------------------------------------------------------------
# Environment Settings
# ----------------------------------------------------------------------------
ENVIRONMENT=development
DEBUG=true
TESTING=false

# API settings
API_V1_PREFIX=/api/v1
API_TITLE=TesiGo API
API_VERSION=2.3.0

# ----------------------------------------------------------------------------
# Background Jobs & WebSocket
# ----------------------------------------------------------------------------
# Background job settings
BACKGROUND_JOB_TIMEOUT=3600
BACKGROUND_JOB_MAX_RETRIES=3

# WebSocket settings
WEBSOCKET_HEARTBEAT_INTERVAL=30
WEBSOCKET_MAX_CONNECTIONS=1000

# ----------------------------------------------------------------------------
# Document Generation Settings
# ----------------------------------------------------------------------------
# Memory management
GENERATION_MAX_CONTEXT_SECTIONS=10
GENERATION_CHECKPOINT_INTERVAL=300

# Supported languages
SUPPORTED_LANGUAGES=en,de,fr,es,it,cs,uk

# Default generation settings
DEFAULT_CITATION_STYLE=APA
DEFAULT_LANGUAGE=en
DEFAULT_AI_MODEL=gpt-4

# ----------------------------------------------------------------------------
# Notes:
# ----------------------------------------------------------------------------
# 1. Replace all "your-*-key-here" values with real API keys
# 2. For production, generate strong SECRET_KEY and JWT_SECRET
# 3. Never commit this file to Git (already in .gitignore)
# 4. Minimal required keys: OPENAI_API_KEY or ANTHROPIC_API_KEY
# 5. For local development, use localhost URLs
# 6. For Docker, use service names (postgres, redis, minio)
# ============================================================================
