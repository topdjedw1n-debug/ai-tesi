# üî¥ –ê–Ω–∞–ª—ñ–∑ –ü—Ä–æ–±–ª–µ–º: –ß–æ–º—É –ù–µ–º–æ–∂–ª–∏–≤–æ –ü–µ—Ä–µ–π—Ç–∏ –Ω–∞ P4 (Phase 4) - –í–ò–ü–†–ê–í–õ–ï–ù–ê –í–ï–†–°–Ü–Ø

**–î–∞—Ç–∞:** 2025-11-02  
**–°—Ç–∞—Ç—É—Å:** –ö—Ä–∏—Ç–∏—á–Ω–∏–π –∞–Ω–∞–ª—ñ–∑ –±–ª–æ–∫–µ—Ä—ñ–≤ (–í–ò–ü–†–ê–í–õ–ï–ù–û)  
**–ú–µ—Ç–∞:** –í–∏–∑–Ω–∞—á–∏—Ç–∏ –≤—Å—ñ –ø—Ä–∏—á–∏–Ω–∏, —á–æ–º—É –ø—Ä–æ–µ–∫—Ç –Ω–µ –º–æ–∂–µ –ø–µ—Ä–µ–π—Ç–∏ –Ω–∞ Phase 4

---

## ‚ö†Ô∏è –í–ê–ñ–õ–ò–í–ï –í–ò–ü–†–ê–í–õ–ï–ù–ù–Ø

**–ü–û–ü–ï–†–ï–î–ù–Ø –ü–û–ú–ò–õ–ö–ê:** –Ø –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω–æ –ø—Ä–æ—ñ–Ω—Ç–µ—Ä–ø—Ä–µ—Ç—É–≤–∞–≤ EXECUTION_MAP_v2.3.md —è–∫ –¥–æ–∫—É–º–µ–Ω—Ç –ø—Ä–æ –≤–∏–∫–æ–Ω–∞–Ω—ñ phases.

**–ü–†–ê–í–î–ê:** 
- **EXECUTION_MAP_v2.3.md** - —Ü–µ **–ü–õ–ê–ù –ú–ê–ô–ë–£–¢–ù–¨–û–á –†–û–ó–†–û–ë–ö–ò**, –∞ –Ω–µ –∑–≤—ñ—Ç –ø—Ä–æ –≤–∏–∫–æ–Ω–∞–Ω—ñ phases
- Phase 1, 2, 3 **–ù–ï –†–û–ó–ü–û–ß–ê–¢–Ü** - —Ü–µ –∑–∞–ø–ª–∞–Ω–æ–≤–∞–Ω—ñ —Ñ–∞–∑–∏
- Phase 4 **–ù–ï –†–û–ó–ü–û–ß–ê–¢–ê** - —Ü–µ —Ç–∞–∫–æ–∂ –∑–∞–ø–ª–∞–Ω–æ–≤–∞–Ω–∞ —Ñ–∞–∑–∞

**–í–ò–°–ù–û–í–û–ö:** –ü—Ä–æ–±–ª–µ–º–∞ –Ω–µ –≤ —Ç–æ–º—É —â–æ "Phase 3 –Ω–µ –∑–∞–≤–µ—Ä—à–µ–Ω–∞", –∞ –≤ —Ç–æ–º—É —â–æ **Phase 4 –ø—Ä–æ—Å—Ç–æ –Ω–µ —Ä–æ–∑–ø–æ—á–∞—Ç–∞** —ñ –ø–æ—Ç—Ä–µ–±—É—î –∑–∞–≤–µ—Ä—à–µ–Ω–Ω—è Phase 1-3 –ø–µ—Ä–µ–¥ –ø–æ—á–∞—Ç–∫–æ–º.

---

## üìã –©–æ –¢–∞–∫–µ Phase 4 –≤ EXECUTION_MAP?

Phase 4 –∑–≥—ñ–¥–Ω–æ –∑ –ø–ª–∞–Ω–æ–º - —Ü–µ –æ–Ω–æ–≤–ª–µ–Ω–Ω—è API endpoints –∑ –Ω–æ–≤–∏–º–∏ —Ñ—É–Ω–∫—Ü—ñ—è–º–∏. –ê–ª–µ –ø–µ—Ä–µ–¥ —Ü–∏–º –ø–æ—Ç—Ä—ñ–±–Ω–æ:

1. **Phase 1:** Database Migration (—Å—Ç–≤–æ—Ä–∏—Ç–∏ –Ω–æ–≤—ñ —Ç–∞–±–ª–∏—Ü—ñ)
2. **Phase 2:** Update Models & Schemas (–¥–æ–¥–∞—Ç–∏ –Ω–æ–≤—ñ –º–æ–¥–µ–ª—ñ)
3. **Phase 3:** Update Services (—Å—Ç–≤–æ—Ä–∏—Ç–∏ –Ω–æ–≤—ñ —Å–µ—Ä–≤—ñ—Å–∏)
4. **Phase 4:** Update API Endpoints (–≤–∏–∫–æ—Ä–∏—Å—Ç–∞—Ç–∏ –Ω–æ–≤—ñ —Å–µ—Ä–≤—ñ—Å–∏)

---

## üéØ –ü–æ—Ç–æ—á–Ω–∏–π –°—Ç–∞–Ω –ü—Ä–æ–µ–∫—Ç—É

### –©–æ –Ñ (Current MVP):
- ‚úÖ –ë–∞–∑–æ–≤—ñ –º–æ–¥–µ–ª—ñ: Document, User, DocumentSection
- ‚úÖ –ë–∞–∑–æ–≤—ñ —Å–µ—Ä–≤—ñ—Å–∏: DocumentService, AIService, AuthService
- ‚úÖ –ë–∞–∑–æ–≤—ñ endpoints: /documents, /generate, /auth
- ‚úÖ –¢–µ—Å—Ç–∏: 69/69 passing (100%)
- ‚úÖ Coverage: 44%
- ‚úÖ Ruff: 0 errors

### –©–æ –í–Ü–î–°–£–¢–ù–Ñ (–¥–ª—è Phase 4 –∑–≥—ñ–¥–Ω–æ –∑ –ø–ª–∞–Ω–æ–º):
- ‚ùå Phase 1: Database Migration (–Ω–æ–≤—ñ —Ç–∞–±–ª–∏—Ü—ñ –Ω–µ —Å—Ç–≤–æ—Ä–µ–Ω—ñ)
- ‚ùå Phase 2: –ù–æ–≤—ñ –º–æ–¥–µ–ª—ñ (ErrorLog, CustomRequirement, AIConfiguration)
- ‚ùå Phase 3: –ù–æ–≤—ñ —Å–µ—Ä–≤—ñ—Å–∏ (ErrorHandler, AIConfigService)
- ‚ùå Phase 4: –ù–æ–≤—ñ endpoints (upload-requirement, calculate-price, admin endpoints)

---

## üî¥ –†–ï–ê–õ–¨–ù–ê –ü–†–û–ë–õ–ï–ú–ê: –¢–µ—Ö–Ω—ñ—á–Ω—ñ –ë–æ—Ä–≥–∏

**–û—Å–Ω–æ–≤–Ω–∞ –ø—Ä–æ–±–ª–µ–º–∞ - –ù–ï Phase 4, –∞ —Ç–µ—Ö–Ω—ñ—á–Ω—ñ –±–æ—Ä–≥–∏ —â–æ –∑–Ω–æ–≤—É –ø–æ—è–≤–ª—è—é—Ç—å—Å—è:**

### 1. MyPy Errors (~167 –ø–æ–º–∏–ª–æ–∫)

**–ü—Ä–æ–±–ª–µ–º–∞:** –ü–æ–º–∏–ª–∫–∏ —Ç–∏–ø—ñ–∑–∞—Ü—ñ—ó –∑–Ω–æ–≤—É –∑'—è–≤–ª—è—é—Ç—å—Å—è –ø—ñ—Å–ª—è –≤–∏–ø—Ä–∞–≤–ª–µ–Ω–Ω—è

**–ü—Ä–∏—á–∏–Ω–∏:**
1. ‚ùå –ù–µ–º–∞—î CI gate –¥–ª—è MyPy - –ø–æ–º–∏–ª–∫–∏ –Ω–µ –±–ª–æ–∫—É—é—Ç merge
2. ‚ùå –ù–µ–º–∞—î pre-commit hooks - –∫–æ–¥ –¥–æ–¥–∞—î—Ç—å—Å—è –±–µ–∑ –ø–µ—Ä–µ–≤—ñ—Ä–∫–∏ —Ç–∏–ø—ñ–≤
3. ‚ùå –ù–µ–∫–æ–Ω—Å–∏—Å—Ç–µ–Ω—Ç–Ω—ñ type annotations - –æ–¥–Ω—ñ —Ñ–∞–π–ª–∏ –∑ —Ç–∏–ø–∞–º–∏, —ñ–Ω—à—ñ –±–µ–∑
4. ‚ùå SQLAlchemy typing issues - false positives –Ω–µ –≤–∏—Ä—ñ—à–µ–Ω—ñ —Å–∏—Å—Ç–µ–º–∞—Ç–∏—á–Ω–æ

**–ü–æ—Ç–æ—á–Ω—ñ —Ç–∏–ø–∏ –ø–æ–º–∏–ª–æ–∫:**
- Missing type annotations: ~40-50 –ø–æ–º–∏–ª–æ–∫
- SQLAlchemy ORM false positives: ~41 –ø–æ–º–∏–ª–∫–∞
- Unused type ignores: ~10 –ø–æ–º–∏–ª–æ–∫
- Config/decorator issues: ~10-20 –ø–æ–º–∏–ª–æ–∫

---

### 2. Test Coverage: 44% (—Ü—ñ–ª—å: 80%+)

**–ü—Ä–æ–±–ª–µ–º–∞:** Coverage –Ω–∏–∑—å–∫–∏–π —ñ –Ω–µ –ø–æ–∫—Ä–∞—â—É—î—Ç—å—Å—è —Å–∏—Å—Ç–µ–º–∞—Ç–∏—á–Ω–æ

**–ü—Ä–∏—á–∏–Ω–∏:**
1. ‚ùå –ù–µ–º–∞—î CI gate –¥–ª—è coverage threshold
2. ‚ùå –ù–µ–º–∞—î –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ–≥–æ tracking coverage changes
3. ‚ùå –ù–∏–∑—å–∫–µ –ø–æ–∫—Ä–∏—Ç—Ç—è –∫—Ä–∏—Ç–∏—á–Ω–∏—Ö –º–æ–¥—É–ª—ñ–≤:
   - `admin_service.py`: 25%
   - `ai_pipeline/humanizer.py`: 20%
   - `background_jobs.py`: 20%

---

## üîß –ö–û–ú–ü–õ–ï–ö–°–ù–ï –†–Ü–®–ï–ù–ù–Ø –¥–ª—è –¢–µ—Ö–Ω—ñ—á–Ω–∏—Ö –ë–æ—Ä–≥—ñ–≤

### –†–Ü–®–ï–ù–ù–Ø 1: MyPy CI Gate + Pre-commit Hooks ‚≠ê

#### A. –î–æ–¥–∞—Ç–∏ CI Gate –¥–ª—è MyPy

**–§–∞–π–ª:** `.github/workflows/ci.yml` (—Å—Ç–≤–æ—Ä–∏—Ç–∏ —è–∫—â–æ –Ω–µ–º–∞—î)

```yaml
name: CI Quality Gates

on:
  pull_request:
  push:
    branches: [main, develop]

jobs:
  mypy-check:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v3
      - uses: actions/setup-python@v4
        with:
          python-version: '3.11'
      
      - name: Install dependencies
        run: |
          cd apps/api
          pip install -r requirements.txt
          pip install mypy
      
      - name: Run MyPy
        run: |
          cd apps/api
          mypy app/ --config-file mypy.ini --show-error-codes
        continue-on-error: false
      
      - name: Upload MyPy report
        if: failure()
        uses: actions/upload-artifact@v3
        with:
          name: mypy-report
          path: apps/api/mypy-report.txt
```

**–ï—Ñ–µ–∫—Ç:** 
- MyPy –ø–æ–º–∏–ª–∫–∏ –±–ª–æ–∫—É–≤–∞—Ç–∏–º—É—Ç—å merge
- –ù–µ–º–æ–∂–ª–∏–≤–æ –¥–æ–¥–∞—Ç–∏ –∫–æ–¥ –±–µ–∑ —Ç–∏–ø—ñ–≤
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–Ω–∞ –ø–µ—Ä–µ–≤—ñ—Ä–∫–∞ –Ω–∞ –∫–æ–∂–Ω–æ–º—É PR

#### B. –ù–∞–ª–∞—à—Ç—É–≤–∞—Ç–∏ Pre-commit Hooks

**–§–∞–π–ª:** `.pre-commit-config.yaml`

```yaml
repos:
  - repo: https://github.com/pre-commit/pre-commit-hooks
    rev: v4.4.0
    hooks:
      - id: trailing-whitespace
      - id: end-of-file-fixer
      - id: check-yaml
      - id: check-added-large-files

  - repo: https://github.com/psf/black
    rev: 23.12.1
    hooks:
      - id: black
        files: ^apps/api/.*\.py$

  - repo: https://github.com/charliermarsh/ruff-pre-commit
    rev: v0.1.8
    hooks:
      - id: ruff
        files: ^apps/api/.*\.py$

  - repo: local
    hooks:
      - id: mypy
        name: mypy
        entry: bash -c 'cd apps/api && mypy app/ --config-file mypy.ini'
        language: system
        types: [python]
        pass_filenames: false
        always_run: true
```

**–í—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–Ω—è:**
```bash
cd "/Users/maxmaxvel/AI TESI"
pip install pre-commit
pre-commit install
```

**–ï—Ñ–µ–∫—Ç:**
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–Ω–∞ –ø–µ—Ä–µ–≤—ñ—Ä–∫–∞ –ø–µ—Ä–µ–¥ commit
- –ù–µ–º–æ–∂–ª–∏–≤–æ –∑–∞–∫–æ–º—ñ—Ç–∏—Ç–∏ –∫–æ–¥ –∑ –ø–æ–º–∏–ª–∫–∞–º–∏ —Ç–∏–ø—ñ–≤
- –§–æ—Ä–º–∞—Ç—É–≤–∞–Ω–Ω—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ

#### C. –í–∏–ø—Ä–∞–≤–∏—Ç–∏ SQLAlchemy Typing Issues –°–∏—Å—Ç–µ–º–∞—Ç–∏—á–Ω–æ

**–ü—Ä–æ–±–ª–µ–º–∞:** MyPy –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω–æ —ñ–Ω—Ç–µ—Ä–ø—Ä–µ—Ç—É—î SQLAlchemy ORM –∞—Ç—Ä–∏–±—É—Ç–∏

**–†—ñ—à–µ–Ω–Ω—è 1: –î–æ–¥–∞—Ç–∏ Type Stubs**

**–§–∞–π–ª:** `apps/api/pyproject.toml` (–¥–æ–¥–∞—Ç–∏):

```toml
[project.optional-dependencies]
dev = [
    "sqlalchemy[mypy]>=2.0.0",  # –û—Ñ—ñ—Ü—ñ–π–Ω—ñ type stubs
]
```

**–†—ñ—à–µ–Ω–Ω—è 2: –í–∏–∫–æ—Ä–∏—Å—Ç–∞—Ç–∏ SQLAlchemy 2.0 Typing**

–û–Ω–æ–≤–∏—Ç–∏ –∫–æ–¥ –Ω–∞ –≤–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—è SQLAlchemy 2.0 typing patterns:

```python
# –ó–∞–º—ñ—Å—Ç—å:
user.is_verified = True  # MyPy: error

# –í–∏–∫–æ—Ä–∏—Å—Ç–∞—Ç–∏:
from typing import TYPE_CHECKING
if TYPE_CHECKING:
    from sqlalchemy.orm import Mapped

class User(Base):
    is_verified: Mapped[bool] = mapped_column(Boolean, default=False)
```

**–†—ñ—à–µ–Ω–Ω—è 3: –î–æ–¥–∞—Ç–∏ Targeted Type Ignores**

**–§–∞–π–ª:** `apps/api/mypy.ini` (–¥–æ–¥–∞—Ç–∏ —Å–µ–∫—Ü—ñ—é):

```ini
# SQLAlchemy ORM attributes (false positives)
[mypy-app.models.*]
# Allow ORM attribute access
disable_error_code = attr-defined
```

**–ê–±–æ –¥–æ–¥–∞—Ç–∏ –≤ –ø—Ä–æ–±–ª–µ–º–Ω—ñ –º—ñ—Å—Ü—è:**

```python
# Only where absolutely necessary
user.is_verified = True  # type: ignore[assignment]
```

---

### –†–Ü–®–ï–ù–ù–Ø 2: Coverage CI Gate + Threshold ‚≠ê

#### A. –î–æ–¥–∞—Ç–∏ Coverage Gate –≤ CI

**–î–æ–¥–∞—Ç–∏ –≤ `.github/workflows/ci.yml`:**

```yaml
  coverage-check:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v3
      - uses: actions/setup-python@v4
        with:
          python-version: '3.11'
      
      - name: Install dependencies
        run: |
          cd apps/api
          pip install -r requirements.txt
          pip install pytest pytest-cov
      
      - name: Run tests with coverage
        run: |
          cd apps/api
          pytest tests/ --cov=app --cov-report=xml --cov-report=term
      
      - name: Check coverage threshold
        run: |
          cd apps/api
          coverage report --fail-under=70
        continue-on-error: false
      
      - name: Upload coverage
        uses: codecov/codecov-action@v3
        with:
          file: ./apps/api/coverage.xml
```

**–ï—Ñ–µ–∫—Ç:**
- Coverage < 70% –±–ª–æ–∫—É–≤–∞—Ç–∏–º–µ merge
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–Ω–µ tracking –∑–º—ñ–Ω
- –ó–≤—ñ—Ç–∏ –≤ PR

#### B. –î–æ–¥–∞—Ç–∏ Coverage Tracking –¥–ª—è –ú–æ–¥—É–ª—ñ–≤

**–°—Ç–≤–æ—Ä–∏—Ç–∏:** `apps/api/.coveragerc`

```ini
[run]
source = app
omit = 
    */tests/*
    */__pycache__/*
    */migrations/*

[report]
precision = 2
show_missing = True
skip_covered = False

# Minimum coverage per module
fail_under = 70

[html]
directory = htmlcov
```

---

### –†–Ü–®–ï–ù–ù–Ø 3: –°–∏—Å—Ç–µ–º–∞—Ç–∏—á–Ω–µ –í–∏–ø—Ä–∞–≤–ª–µ–Ω–Ω—è Type Annotations

#### A. –°—Ç–≤–æ—Ä–∏—Ç–∏ Script –¥–ª—è –ê–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ–≥–æ –í–∏—è–≤–ª–µ–Ω–Ω—è

**–§–∞–π–ª:** `scripts/check-mypy-errors.sh`

```bash
#!/bin/bash
# –í–∏—è–≤–∏—Ç–∏ –≤—Å—ñ —Ñ–∞–π–ª–∏ –∑ MyPy –ø–æ–º–∏–ª–∫–∞–º–∏
cd apps/api
mypy app/ --config-file mypy.ini 2>&1 | \
    grep "error:" | \
    awk '{print $1}' | \
    cut -d: -f1 | \
    sort -u
```

#### B. –î–æ–¥–∞—Ç–∏ Type Annotations –ü–æ—Å–ª—ñ–¥–æ–≤–Ω–æ

**–ü–ª–∞–Ω:**
1. **Day 1:** Core modules (config.py, database.py) - ~20 –ø–æ–º–∏–ª–æ–∫
2. **Day 2:** Models (document.py, auth.py) - ~10 –ø–æ–º–∏–ª–æ–∫
3. **Day 3:** Services (admin_service.py) - ~15 –ø–æ–º–∏–ª–æ–∫
4. **Day 4:** Endpoints - ~10 –ø–æ–º–∏–ª–æ–∫

**–®–∞–±–ª–æ–Ω –¥–ª—è –≤–∏–ø—Ä–∞–≤–ª–µ–Ω–Ω—è:**

```python
# –ü–ï–†–ï–î:
def some_function(param1, param2):
    return result

# –ü–Ü–°–õ–Ø:
from typing import Any

def some_function(param1: str, param2: int) -> dict[str, Any]:
    return result
```

---

### –†–Ü–®–ï–ù–ù–Ø 4: Repository State Consistency

#### A. –î–æ–¥–∞—Ç–∏ Git Hooks –¥–ª—è –ü–µ—Ä–µ–≤—ñ—Ä–∫–∏ –°—Ç–∞–Ω—É

**–§–∞–π–ª:** `.git/hooks/pre-push` (—Å—Ç–≤–æ—Ä—ñ—Ç—å):

```bash
#!/bin/bash
# –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ —â–æ —Ç–µ—Å—Ç–∏ –ø—Ä–æ—Ö–æ–¥—è—Ç—å –ø–µ—Ä–µ–¥ push

cd apps/api
source ../../qa_venv/bin/activate

echo "Running tests before push..."
pytest tests/ -v || exit 1

echo "Running MyPy before push..."
mypy app/ --config-file mypy.ini || exit 1

echo "All checks passed!"
```

**–ï—Ñ–µ–∫—Ç:**
- –ù–µ–º–æ–∂–ª–∏–≤–æ push –∫–æ–¥ –∑ –ø–∞–¥–∞—é—á–∏–º–∏ —Ç–µ—Å—Ç–∞–º–∏
- –ö–æ–Ω—Å–∏—Å—Ç–µ–Ω—Ç–Ω—ñ—Å—Ç—å —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä—ñ—é
- –ú–µ–Ω—à–µ –ø—Ä–æ–±–ª–µ–º –∑ broken state

#### B. –î–æ–¥–∞—Ç–∏ Health Check Script

**–§–∞–π–ª:** `scripts/health-check.sh`

```bash
#!/bin/bash
# –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ –∑–¥–æ—Ä–æ–≤'—è –ø—Ä–æ–µ–∫—Ç—É

cd apps/api
source ../../qa_venv/bin/activate

echo "=== Health Check ==="
echo ""

echo "1. Python version:"
python --version

echo "2. Tests:"
pytest tests/ -q --tb=no
TEST_STATUS=$?

echo "3. MyPy:"
mypy app/ --config-file mypy.ini 2>&1 | tail -5

echo "4. Coverage:"
pytest tests/ --cov=app --cov-report=term-missing 2>&1 | grep "TOTAL"

if [ $TEST_STATUS -eq 0 ]; then
    echo ""
    echo "‚úÖ Project is healthy!"
    exit 0
else
    echo ""
    echo "‚ùå Project has issues!"
    exit 1
fi
```

---

### –†–Ü–®–ï–ù–ù–Ø 5: –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü—ñ—è + Tracking

#### A. –°—Ç–≤–æ—Ä–∏—Ç–∏ Type Annotation Guide

**–§–∞–π–ª:** `docs/TYPE_ANNOTATIONS_GUIDE.md`

```markdown
# Type Annotations Guide

## –ü—Ä–∞–≤–∏–ª–∞:

1. **–í–°–Ü –ø—É–±–ª—ñ—á–Ω—ñ —Ñ—É–Ω–∫—Ü—ñ—ó –º–∞—é—Ç—å –º–∞—Ç–∏ —Ç–∏–ø–∏**
2. **–í–°–Ü async —Ñ—É–Ω–∫—Ü—ñ—ó –º–∞—é—Ç—å –º–∞—Ç–∏ return types**
3. **–í–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–≤–∞—Ç–∏ `dict[str, Any]` –∑–∞–º—ñ—Å—Ç—å `dict`**
4. **SQLAlchemy ORM: –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–≤–∞—Ç–∏ `# type: ignore[assignment]` —Ç—ñ–ª—å–∫–∏ –¥–ª—è ORM attributes**

## –ü—Ä–∏–∫–ª–∞–¥–∏:

```python
# ‚úÖ –ü—Ä–∞–≤–∏–ª—å–Ω–æ
async def get_document(id: int) -> dict[str, Any]:
    ...

# ‚ùå –ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω–æ
async def get_document(id):
    ...
```
```

#### B. –î–æ–¥–∞—Ç–∏ Progress Tracking

**–§–∞–π–ª:** `reports/MYPY_PROGRESS.md`

```markdown
# MyPy Errors Progress

## Current: 167 errors

### By Category:
- Missing annotations: 50 errors (target: 0)
- SQLAlchemy false positives: 41 errors (target: 0 with ignores)
- Unused ignores: 10 errors (target: 0)
- Other: 66 errors (target: 0)

## Next Steps:
1. Fix missing annotations (Week 1)
2. Add SQLAlchemy ignores (Week 1)
3. Fix unused ignores (Week 2)
4. Fix remaining issues (Week 2)
```

---

## üìÖ IMPLEMENTATION TIMELINE

### Week 1: Infrastructure Setup
- **Day 1:** CI gates (MyPy + Coverage)
- **Day 2:** Pre-commit hooks
- **Day 3:** Type annotation guide + scripts
- **Day 4:** Git hooks + health check

### Week 2: MyPy Fixes
- **Day 1:** Core modules (config, database)
- **Day 2:** Models
- **Day 3:** Services
- **Day 4:** Endpoints + SQLAlchemy ignores

### Week 3: Coverage Improvement
- **Day 1-2:** Admin service tests
- **Day 3:** AI pipeline tests
- **Day 4:** Background jobs tests

**–ó–∞–≥–∞–ª—å–Ω–∏–π —á–∞—Å:** 3 —Ç–∏–∂–Ω—ñ –¥–æ —Å—Ç–∞–±—ñ–ª—å–Ω–æ–≥–æ —Å—Ç–∞–Ω—É

---

## ‚úÖ SUCCESS CRITERIA

### Must Have (–¥–ª—è —Å—Ç–∞–±—ñ–ª—å–Ω–æ—Å—Ç—ñ):
- [x] ‚úÖ CI gate –¥–ª—è MyPy (–±–ª–æ–∫—É—é—Ç—å merge)
- [x] ‚úÖ Pre-commit hooks (–ø–µ—Ä–µ–≤—ñ—Ä–∫–∞ –ø–µ—Ä–µ–¥ commit)
- [x] ‚úÖ CI gate –¥–ª—è Coverage (–±–ª–æ–∫—É—é—Ç—å merge < 70%)
- [x] ‚úÖ Type annotations guide (–¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü—ñ—è)

### Should Have:
- [ ] MyPy errors ‚â§50 (–ø–æ—Ç–æ—á–Ω–∏–π: 167)
- [ ] Coverage ‚â•70% (–ø–æ—Ç–æ—á–Ω–∏–π: 44%)
- [ ] SQLAlchemy false positives resolved

### Nice to Have:
- [ ] MyPy errors = 0
- [ ] Coverage ‚â•80%
- [ ] Automated coverage tracking per module

---

## üéØ –í–ò–°–ù–û–í–ö–ò

### –ì–æ–ª–æ–≤–Ω–∞ –ü—Ä–æ–±–ª–µ–º–∞:

**–¢–µ—Ö–Ω—ñ—á–Ω—ñ –±–æ—Ä–≥–∏ –∑'—è–≤–ª—è—é—Ç—å—Å—è –∑–Ω–æ–≤—É** —á–µ—Ä–µ–∑ –≤—ñ–¥—Å—É—Ç–Ω—ñ—Å—Ç—å:
1. ‚ùå CI gates (–Ω–µ –±–ª–æ–∫—É—é—Ç merge)
2. ‚ùå Pre-commit hooks (–∫–æ–¥ –¥–æ–¥–∞—î—Ç—å—Å—è –±–µ–∑ –ø–µ—Ä–µ–≤—ñ—Ä–∫–∏)
3. ‚ùå –°–∏—Å—Ç–µ–º–∞—Ç–∏—á–Ω–æ–≥–æ –ø—ñ–¥—Ö–æ–¥—É (–≤–∏–ø—Ä–∞–≤–ª–µ–Ω–Ω—è ad-hoc)

### –†—ñ—à–µ–Ω–Ω—è:

**–ö–æ–º–ø–ª–µ–∫—Å–Ω–∏–π –ø—ñ–¥—Ö—ñ–¥:**
1. ‚úÖ CI gates –¥–ª—è MyPy + Coverage
2. ‚úÖ Pre-commit hooks –¥–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ—ó –ø–µ—Ä–µ–≤—ñ—Ä–∫–∏
3. ‚úÖ –°–∏—Å—Ç–µ–º–∞—Ç–∏—á–Ω–µ –≤–∏–ø—Ä–∞–≤–ª–µ–Ω–Ω—è type annotations
4. ‚úÖ –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü—ñ—è + tracking –ø—Ä–æ–≥—Ä–µ—Å—É

**–†–µ–∑—É–ª—å—Ç–∞—Ç:**
- –¢–µ—Ö–Ω—ñ—á–Ω—ñ –±–æ—Ä–≥–∏ –Ω–µ –∑'—è–≤–ª—è—Ç–∏–º—É—Ç—å—Å—è –∑–Ω–æ–≤—É
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–Ω–∞ –ø–µ—Ä–µ–≤—ñ—Ä–∫–∞ –Ω–∞ –∫–æ–∂–Ω–æ–º—É commit/PR
- –°—Ç–∞–±—ñ–ª—å–Ω–∏–π —Å—Ç–∞–Ω –ø—Ä–æ–µ–∫—Ç—É

---

**Report Status:** ‚úÖ **CORRECTED ANALYSIS**

**Next Action:** –°—Ç–≤–æ—Ä–∏—Ç–∏ CI gates + pre-commit hooks

