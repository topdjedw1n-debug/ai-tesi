[1;33mwarning[0m[1m:[0m [1mThe top-level linter settings are deprecated in favour of their counterparts in the `lint` section. Please update the following options in `pyproject.toml`:
  - 'ignore' -> 'lint.ignore'
  - 'select' -> 'lint.select'
  - 'isort' -> 'lint.isort'
  - 'per-file-ignores' -> 'lint.per-file-ignores'[0m
[1m[91mE712 [0m[1mAvoid equality comparisons to `True`; use `User.is_active:` for truth checks[0m
  [1m[94m-->[0m app/services/admin_service.py:36:25
   [1m[94m|[0m
[1m[94m34 |[0m                 select(func.count(User.id)).where(
[1m[94m35 |[0m                     and_(
[1m[94m36 |[0m                         User.is_active == True,
   [1m[94m|[0m                         [1m[91m^^^^^^^^^^^^^^^^^^^^^^[0m
[1m[94m37 |[0m                         User.last_login > datetime.utcnow() - timedelta(days=30)
[1m[94m38 |[0m                     )
   [1m[94m|[0m
[1m[96mhelp[0m: [1mReplace with `User.is_active`[0m

[1m[91mW293 [0m[[1m[96m*[0m] [1mBlank line contains whitespace[0m
   [1m[94m-->[0m app/services/admin_service.py:199:1
    [1m[94m|[0m
[1m[94m197 |[0m                 if job.completed_at and job.started_at:
[1m[94m198 |[0m                     duration_ms = int((job.completed_at - job.started_at).total_seconds() * 1000)
[1m[94m199 |[0m                 
    [1m[94m|[0m [1m[91m^^^^^^^^^^^^^^^^[0m
[1m[94m200 |[0m                 job_list.append({
[1m[94m201 |[0m                     "id": job.id,
    [1m[94m|[0m
[1m[96mhelp[0m: [1mRemove whitespace from blank line[0m

[1m[91mE712 [0m[1mAvoid equality comparisons to `True`; use `AIGenerationJob.success:` for truth checks[0m
   [1m[94m-->[0m app/services/admin_service.py:302:25
    [1m[94m|[0m
[1m[94m300 |[0m                     and_(
[1m[94m301 |[0m                         AIGenerationJob.started_at > datetime.utcnow() - timedelta(hours=1),
[1m[94m302 |[0m                         AIGenerationJob.success == True
    [1m[94m|[0m                         [1m[91m^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^[0m
[1m[94m303 |[0m                     )
[1m[94m304 |[0m                 )
    [1m[94m|[0m
[1m[96mhelp[0m: [1mReplace with `AIGenerationJob.success`[0m

[1m[91mE712 [0m[1mAvoid equality comparisons to `False`; use `not MagicLinkToken.is_used:` for false checks[0m
  [1m[94m-->[0m app/services/auth_service.py:95:21
   [1m[94m|[0m
[1m[94m93 |[0m                 select(MagicLinkToken).where(
[1m[94m94 |[0m                     MagicLinkToken.token == token,
[1m[94m95 |[0m                     MagicLinkToken.is_used == False,
   [1m[94m|[0m                     [1m[91m^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^[0m
[1m[94m96 |[0m                     MagicLinkToken.is_expired == False,
[1m[94m97 |[0m                     MagicLinkToken.expires_at > datetime.utcnow()
   [1m[94m|[0m
[1m[96mhelp[0m: [1mReplace with `not MagicLinkToken.is_used`[0m

[1m[91mE712 [0m[1mAvoid equality comparisons to `False`; use `not MagicLinkToken.is_expired:` for false checks[0m
  [1m[94m-->[0m app/services/auth_service.py:96:21
   [1m[94m|[0m
[1m[94m94 |[0m                     MagicLinkToken.token == token,
[1m[94m95 |[0m                     MagicLinkToken.is_used == False,
[1m[94m96 |[0m                     MagicLinkToken.is_expired == False,
   [1m[94m|[0m                     [1m[91m^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^[0m
[1m[94m97 |[0m                     MagicLinkToken.expires_at > datetime.utcnow()
[1m[94m98 |[0m                 )
   [1m[94m|[0m
[1m[96mhelp[0m: [1mReplace with `not MagicLinkToken.is_expired`[0m

[1m[91mE712 [0m[1mAvoid equality comparisons to `True`; use `UserSession.is_active:` for truth checks[0m
   [1m[94m-->[0m app/services/auth_service.py:161:21
    [1m[94m|[0m
[1m[94m159 |[0m                 select(UserSession).where(
[1m[94m160 |[0m                     UserSession.session_token == refresh_token,
[1m[94m161 |[0m                     UserSession.is_active == True,
    [1m[94m|[0m                     [1m[91m^^^^^^^^^^^^^^^^^^^^^^^^^^^^^[0m
[1m[94m162 |[0m                     UserSession.expires_at > datetime.utcnow()
[1m[94m163 |[0m                 )
    [1m[94m|[0m
[1m[96mhelp[0m: [1mReplace with `UserSession.is_active`[0m

[1m[91mW293 [0m[[1m[96m*[0m] [1mBlank line contains whitespace[0m
  [1m[94m-->[0m app/services/document_service.py:68:1
   [1m[94m|[0m
[1m[94m66 |[0m             word_count = sum(len(word.strip()) for word in str(document.title + " " + document.topic).split() if word.strip())
[1m[94m67 |[0m             estimated_reading_time = int(word_count / 200)  # Average reading speed 200 words/min
[1m[94m68 |[0m             
   [1m[94m|[0m [1m[91m^^^^^^^^^^^^[0m
[1m[94m69 |[0m             return {
[1m[94m70 |[0m                 "id": document.id,
   [1m[94m|[0m
[1m[96mhelp[0m: [1mRemove whitespace from blank line[0m

[1m[91mW293 [0m[[1m[96m*[0m] [1mBlank line contains whitespace[0m
   [1m[94m-->[0m app/services/document_service.py:110:1
    [1m[94m|[0m
[1m[94m108 |[0m             elif document.title and document.topic:
[1m[94m109 |[0m                 word_count = len((document.title + " " + document.topic).split())
[1m[94m110 |[0m             
    [1m[94m|[0m [1m[91m^^^^^^^^^^^^[0m
[1m[94m111 |[0m             estimated_reading_time = int(word_count / 200) if word_count > 0 else 0
    [1m[94m|[0m
[1m[96mhelp[0m: [1mRemove whitespace from blank line[0m

[1m[91mW293 [0m[[1m[96m*[0m] [1mBlank line contains whitespace[0m
   [1m[94m-->[0m app/services/document_service.py:112:1
    [1m[94m|[0m
[1m[94m111 |[0m             estimated_reading_time = int(word_count / 200) if word_count > 0 else 0
[1m[94m112 |[0m             
    [1m[94m|[0m [1m[91m^^^^^^^^^^^^[0m
[1m[94m113 |[0m             return {
[1m[94m114 |[0m                 "id": document.id,
    [1m[94m|[0m
[1m[96mhelp[0m: [1mRemove whitespace from blank line[0m

[1m[91mW293 [0m[[1m[96m*[0m] [1mBlank line contains whitespace[0m
   [1m[94m-->[0m app/services/document_service.py:182:1
    [1m[94m|[0m
[1m[94m180 |[0m             total_pages = (total_count + limit - 1) // limit if limit > 0 else 0
[1m[94m181 |[0m             current_page = (offset // limit) + 1 if limit > 0 else 1
[1m[94m182 |[0m             
    [1m[94m|[0m [1m[91m^^^^^^^^^^^^[0m
[1m[94m183 |[0m             return {
[1m[94m184 |[0m                 "documents": [
    [1m[94m|[0m
[1m[96mhelp[0m: [1mRemove whitespace from blank line[0m

[1m[91mW293 [0m[[1m[96m*[0m] [1mBlank line contains whitespace[0m
   [1m[94m-->[0m main.py:107:1
    [1m[94m|[0m
[1m[94m105 |[0m     """Standardized unhandled exception handler with structured error response."""
[1m[94m106 |[0m     correlation_id = request.headers.get("X-Request-ID", "unknown")
[1m[94m107 |[0m     
    [1m[94m|[0m [1m[91m^^^^[0m
[1m[94m108 |[0m     # Escape curly braces to prevent format string interpolation errors
[1m[94m109 |[0m     # This prevents KeyError when Pydantic validation errors contain braces
    [1m[94m|[0m
[1m[96mhelp[0m: [1mRemove whitespace from blank line[0m

[1m[91mW293 [0m[[1m[96m*[0m] [1mBlank line contains whitespace[0m
   [1m[94m-->[0m main.py:112:1
    [1m[94m|[0m
[1m[94m110 |[0m     exception_str = str(exc)
[1m[94m111 |[0m     escaped_msg = exception_str.replace("{", "{{").replace("}", "}}")
[1m[94m112 |[0m     
    [1m[94m|[0m [1m[91m^^^^[0m
[1m[94m113 |[0m     logger.exception(
[1m[94m114 |[0m         f"Unhandled exception: {type(exc).__name__} - {escaped_msg}",
    [1m[94m|[0m
[1m[96mhelp[0m: [1mRemove whitespace from blank line[0m

[1m[91mF401 [0m[[1m[96m*[0m] [1m`sqlalchemy.ext.asyncio.AsyncSession` imported but unused[0m
  [1m[94m-->[0m tests/conftest.py:8:36
   [1m[94m|[0m
[1m[94m 7 |[0m import pytest
[1m[94m 8 |[0m from sqlalchemy.ext.asyncio import AsyncSession
   [1m[94m|[0m                                    [1m[91m^^^^^^^^^^^^[0m
[1m[94m 9 |[0m
[1m[94m10 |[0m # Set environment variables BEFORE any test imports
   [1m[94m|[0m
[1m[96mhelp[0m: [1mRemove unused import: `sqlalchemy.ext.asyncio.AsyncSession`[0m

[1m[91mI001 [0m[[1m[96m*[0m] [1mImport block is un-sorted or un-formatted[0m
  [1m[94m-->[0m tests/conftest.py:19:1
   [1m[94m|[0m
[1m[94m17 |[0m os.environ.setdefault("DISABLE_RATE_LIMIT", "true")
[1m[94m18 |[0m
[1m[94m19 |[0m from app.core.database import AsyncSessionLocal, get_engine, Base  # noqa: E402
   [1m[94m|[0m [1m[91m^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^[0m
   [1m[94m|[0m
[1m[96mhelp[0m: [1mOrganize imports[0m

[1m[91mI001 [0m[[1m[96m*[0m] [1mImport block is un-sorted or un-formatted[0m
  [1m[94m-->[0m tests/test_ai_service.py:4:1
   [1m[94m|[0m
[1m[94m 2 |[0m   Unit tests for AIService
[1m[94m 3 |[0m   """
[1m[94m 4 |[0m [1m[91m/[0m import pytest
[1m[94m 5 |[0m [1m[91m|[0m from unittest.mock import AsyncMock, patch, MagicMock
[1m[94m 6 |[0m [1m[91m|[0m
[1m[94m 7 |[0m [1m[91m|[0m from app.core.exceptions import AIProviderError, NotFoundError
[1m[94m 8 |[0m [1m[91m|[0m from app.models.auth import User
[1m[94m 9 |[0m [1m[91m|[0m from app.models.document import Document
[1m[94m10 |[0m [1m[91m|[0m from app.services.ai_service import AIService
   [1m[94m|[0m [1m[91m|_____________________________________________^[0m
   [1m[94m|[0m
[1m[96mhelp[0m: [1mOrganize imports[0m

[1m[91mF401 [0m[[1m[96m*[0m] [1m`unittest.mock.AsyncMock` imported but unused[0m
 [1m[94m-->[0m tests/test_ai_service.py:5:27
  [1m[94m|[0m
[1m[94m3 |[0m """
[1m[94m4 |[0m import pytest
[1m[94m5 |[0m from unittest.mock import AsyncMock, patch, MagicMock
  [1m[94m|[0m                           [1m[91m^^^^^^^^^[0m
[1m[94m6 |[0m
[1m[94m7 |[0m from app.core.exceptions import AIProviderError, NotFoundError
  [1m[94m|[0m
[1m[96mhelp[0m: [1mRemove unused import[0m

[1m[91mF401 [0m[[1m[96m*[0m] [1m`unittest.mock.patch` imported but unused[0m
 [1m[94m-->[0m tests/test_ai_service.py:5:38
  [1m[94m|[0m
[1m[94m3 |[0m """
[1m[94m4 |[0m import pytest
[1m[94m5 |[0m from unittest.mock import AsyncMock, patch, MagicMock
  [1m[94m|[0m                                      [1m[91m^^^^^[0m
[1m[94m6 |[0m
[1m[94m7 |[0m from app.core.exceptions import AIProviderError, NotFoundError
  [1m[94m|[0m
[1m[96mhelp[0m: [1mRemove unused import[0m

[1m[91mF401 [0m[[1m[96m*[0m] [1m`unittest.mock.MagicMock` imported but unused[0m
 [1m[94m-->[0m tests/test_ai_service.py:5:45
  [1m[94m|[0m
[1m[94m3 |[0m """
[1m[94m4 |[0m import pytest
[1m[94m5 |[0m from unittest.mock import AsyncMock, patch, MagicMock
  [1m[94m|[0m                                             [1m[91m^^^^^^^^^[0m
[1m[94m6 |[0m
[1m[94m7 |[0m from app.core.exceptions import AIProviderError, NotFoundError
  [1m[94m|[0m
[1m[96mhelp[0m: [1mRemove unused import[0m

[1m[91mF401 [0m[[1m[96m*[0m] [1m`app.core.exceptions.NotFoundError` imported but unused[0m
 [1m[94m-->[0m tests/test_ai_service.py:7:50
  [1m[94m|[0m
[1m[94m5 |[0m from unittest.mock import AsyncMock, patch, MagicMock
[1m[94m6 |[0m
[1m[94m7 |[0m from app.core.exceptions import AIProviderError, NotFoundError
  [1m[94m|[0m                                                  [1m[91m^^^^^^^^^^^^^[0m
[1m[94m8 |[0m from app.models.auth import User
[1m[94m9 |[0m from app.models.document import Document
  [1m[94m|[0m
[1m[96mhelp[0m: [1mRemove unused import: `app.core.exceptions.NotFoundError`[0m

[1m[91mI001 [0m[[1m[96m*[0m] [1mImport block is un-sorted or un-formatted[0m
  [1m[94m-->[0m tests/test_ai_service_extended.py:4:1
   [1m[94m|[0m
[1m[94m 2 |[0m   Extended tests for AIService to improve coverage
[1m[94m 3 |[0m   """
[1m[94m 4 |[0m [1m[91m/[0m import pytest
[1m[94m 5 |[0m [1m[91m|[0m from unittest.mock import AsyncMock, patch, MagicMock
[1m[94m 6 |[0m [1m[91m|[0m
[1m[94m 7 |[0m [1m[91m|[0m from app.core.exceptions import AIProviderError, NotFoundError
[1m[94m 8 |[0m [1m[91m|[0m from app.models.auth import User
[1m[94m 9 |[0m [1m[91m|[0m from app.models.document import Document, DocumentOutline
[1m[94m10 |[0m [1m[91m|[0m from app.services.ai_service import AIService
   [1m[94m|[0m [1m[91m|_____________________________________________^[0m
   [1m[94m|[0m
[1m[96mhelp[0m: [1mOrganize imports[0m

[1m[91mW293 [0m[[1m[96m*[0m] [1mBlank line contains whitespace[0m
  [1m[94m-->[0m tests/test_ai_service_extended.py:17:1
   [1m[94m|[0m
[1m[94m15 |[0m     """Test getting usage for non-existent user"""
[1m[94m16 |[0m     service = AIService(db_session)
[1m[94m17 |[0m     
   [1m[94m|[0m [1m[91m^^^^[0m
[1m[94m18 |[0m     # Should return zeros for non-existent user
[1m[94m19 |[0m     result = await service.get_user_usage(user_id=99999)
   [1m[94m|[0m
[1m[96mhelp[0m: [1mRemove whitespace from blank line[0m

[1m[91mW293 [0m[[1m[96m*[0m] [1mBlank line contains whitespace[0m
  [1m[94m-->[0m tests/test_ai_service_extended.py:58:1
   [1m[94m|[0m
[1m[94m56 |[0m     with patch.object(service, '_call_ai_provider', new_callable=AsyncMock) as mock_call:
[1m[94m57 |[0m         mock_call.return_value = mock_response
[1m[94m58 |[0m         
   [1m[94m|[0m [1m[91m^^^^^^^^[0m
[1m[94m59 |[0m         result = await service.generate_outline(
[1m[94m60 |[0m             document_id=document.id,
   [1m[94m|[0m
[1m[96mhelp[0m: [1mRemove whitespace from blank line[0m

[1m[91mW293 [0m[[1m[96m*[0m] [1mBlank line contains whitespace[0m
   [1m[94m-->[0m tests/test_ai_service_extended.py:116:1
    [1m[94m|[0m
[1m[94m114 |[0m     with patch.object(SectionGenerator, 'generate_section', new_callable=AsyncMock) as mock_section_gen:
[1m[94m115 |[0m         mock_section_gen.return_value = mock_response
[1m[94m116 |[0m         
    [1m[94m|[0m [1m[91m^^^^^^^^[0m
[1m[94m117 |[0m         result = await service.generate_section(
[1m[94m118 |[0m             document_id=document.id,
    [1m[94m|[0m
[1m[96mhelp[0m: [1mRemove whitespace from blank line[0m

[1m[91mI001 [0m[[1m[96m*[0m] [1mImport block is un-sorted or un-formatted[0m
   [1m[94m-->[0m tests/test_ai_service_extended.py:184:5
    [1m[94m|[0m
[1m[94m182 |[0m   async def test_call_openai_success_mock(db_session):
[1m[94m183 |[0m       """Test calling OpenAI successfully with mock"""
[1m[94m184 |[0m [1m[91m/[0m     from app.core.config import settings
[1m[94m185 |[0m [1m[91m|[0m     from unittest.mock import patch
    [1m[94m|[0m [1m[91m|___________________________________^[0m
[1m[94m186 |[0m       
[1m[94m187 |[0m       # Save original key
    [1m[94m|[0m
[1m[96mhelp[0m: [1mOrganize imports[0m

[1m[91mW293 [0m[[1m[96m*[0m] [1mBlank line contains whitespace[0m
   [1m[94m-->[0m tests/test_ai_service_extended.py:186:1
    [1m[94m|[0m
[1m[94m184 |[0m     from app.core.config import settings
[1m[94m185 |[0m     from unittest.mock import patch
[1m[94m186 |[0m     
    [1m[94m|[0m [1m[91m^^^^[0m
[1m[94m187 |[0m     # Save original key
[1m[94m188 |[0m     original_key = settings.OPENAI_API_KEY
    [1m[94m|[0m
[1m[96mhelp[0m: [1mRemove whitespace from blank line[0m

[1m[91mW293 [0m[[1m[96m*[0m] [1mBlank line contains whitespace[0m
   [1m[94m-->[0m tests/test_ai_service_extended.py:199:1
    [1m[94m|[0m
[1m[94m197 |[0m     mock_response.usage = MagicMock()
[1m[94m198 |[0m     mock_response.usage.total_tokens = 100
[1m[94m199 |[0m     
    [1m[94m|[0m [1m[91m^^^^[0m
[1m[94m200 |[0m     # Create mock client
[1m[94m201 |[0m     mock_client = MagicMock()
    [1m[94m|[0m
[1m[96mhelp[0m: [1mRemove whitespace from blank line[0m

[1m[91mW293 [0m[[1m[96m*[0m] [1mBlank line contains whitespace[0m
   [1m[94m-->[0m tests/test_ai_service_extended.py:203:1
    [1m[94m|[0m
[1m[94m201 |[0m     mock_client = MagicMock()
[1m[94m202 |[0m     mock_client.chat.completions.create = AsyncMock(return_value=mock_response)
[1m[94m203 |[0m     
    [1m[94m|[0m [1m[91m^^^^[0m
[1m[94m204 |[0m     # Create mock openai module with AsyncOpenAI class
[1m[94m205 |[0m     mock_openai_module = MagicMock()
    [1m[94m|[0m
[1m[96mhelp[0m: [1mRemove whitespace from blank line[0m

[1m[91mW293 [0m[[1m[96m*[0m] [1mBlank line contains whitespace[0m
   [1m[94m-->[0m tests/test_ai_service_extended.py:207:1
    [1m[94m|[0m
[1m[94m205 |[0m     mock_openai_module = MagicMock()
[1m[94m206 |[0m     mock_openai_module.AsyncOpenAI = MagicMock(return_value=mock_client)
[1m[94m207 |[0m     
    [1m[94m|[0m [1m[91m^^^^[0m
[1m[94m208 |[0m     # Patch builtins.__import__ to return our mock when importing openai
[1m[94m209 |[0m     original_import = __import__
    [1m[94m|[0m
[1m[96mhelp[0m: [1mRemove whitespace from blank line[0m

[1m[91mI001 [0m[[1m[96m*[0m] [1mImport block is un-sorted or un-formatted[0m
   [1m[94m-->[0m tests/test_ai_service_extended.py:228:5
    [1m[94m|[0m
[1m[94m226 |[0m   async def test_call_anthropic_success_mock(db_session):
[1m[94m227 |[0m       """Test calling Anthropic successfully with mock"""
[1m[94m228 |[0m [1m[91m/[0m     from app.core.config import settings
[1m[94m229 |[0m [1m[91m|[0m     from unittest.mock import patch
    [1m[94m|[0m [1m[91m|___________________________________^[0m
[1m[94m230 |[0m       
[1m[94m231 |[0m       # Save original key
    [1m[94m|[0m
[1m[96mhelp[0m: [1mOrganize imports[0m

[1m[91mW293 [0m[[1m[96m*[0m] [1mBlank line contains whitespace[0m
   [1m[94m-->[0m tests/test_ai_service_extended.py:230:1
    [1m[94m|[0m
[1m[94m228 |[0m     from app.core.config import settings
[1m[94m229 |[0m     from unittest.mock import patch
[1m[94m230 |[0m     
    [1m[94m|[0m [1m[91m^^^^[0m
[1m[94m231 |[0m     # Save original key
[1m[94m232 |[0m     original_key = settings.ANTHROPIC_API_KEY
    [1m[94m|[0m
[1m[96mhelp[0m: [1mRemove whitespace from blank line[0m

[1m[91mW293 [0m[[1m[96m*[0m] [1mBlank line contains whitespace[0m
   [1m[94m-->[0m tests/test_ai_service_extended.py:244:1
    [1m[94m|[0m
[1m[94m242 |[0m     mock_response.usage.input_tokens = 50
[1m[94m243 |[0m     mock_response.usage.output_tokens = 50
[1m[94m244 |[0m     
    [1m[94m|[0m [1m[91m^^^^[0m
[1m[94m245 |[0m     # Create mock client
[1m[94m246 |[0m     mock_client = MagicMock()
    [1m[94m|[0m
[1m[96mhelp[0m: [1mRemove whitespace from blank line[0m

[1m[91mW293 [0m[[1m[96m*[0m] [1mBlank line contains whitespace[0m
   [1m[94m-->[0m tests/test_ai_service_extended.py:248:1
    [1m[94m|[0m
[1m[94m246 |[0m     mock_client = MagicMock()
[1m[94m247 |[0m     mock_client.messages.create = AsyncMock(return_value=mock_response)
[1m[94m248 |[0m     
    [1m[94m|[0m [1m[91m^^^^[0m
[1m[94m249 |[0m     # Create mock anthropic module with AsyncAnthropic class
[1m[94m250 |[0m     mock_anthropic_module = MagicMock()
    [1m[94m|[0m
[1m[96mhelp[0m: [1mRemove whitespace from blank line[0m

[1m[91mW293 [0m[[1m[96m*[0m] [1mBlank line contains whitespace[0m
   [1m[94m-->[0m tests/test_ai_service_extended.py:252:1
    [1m[94m|[0m
[1m[94m250 |[0m     mock_anthropic_module = MagicMock()
[1m[94m251 |[0m     mock_anthropic_module.AsyncAnthropic = MagicMock(return_value=mock_client)
[1m[94m252 |[0m     
    [1m[94m|[0m [1m[91m^^^^[0m
[1m[94m253 |[0m     # Patch builtins.__import__ to return our mock when importing anthropic
[1m[94m254 |[0m     original_import = __import__
    [1m[94m|[0m
[1m[96mhelp[0m: [1mRemove whitespace from blank line[0m

[1m[91mI001 [0m[[1m[96m*[0m] [1mImport block is un-sorted or un-formatted[0m
  [1m[94m-->[0m tests/test_api_integration.py:18:1
   [1m[94m|[0m
[1m[94m16 |[0m   os.environ.setdefault("DISABLE_RATE_LIMIT", "true")
[1m[94m17 |[0m
[1m[94m18 |[0m [1m[91m/[0m from app.core.database import AsyncSessionLocal, get_engine, Base
[1m[94m19 |[0m [1m[91m|[0m from app.models.auth import User, MagicLinkToken
[1m[94m20 |[0m [1m[91m|[0m from app.models.document import Document
[1m[94m21 |[0m [1m[91m|[0m from app.services.auth_service import AuthService
[1m[94m22 |[0m [1m[91m|[0m from main import app  # noqa: E402
   [1m[94m|[0m [1m[91m|____________________^[0m
   [1m[94m|[0m
[1m[96mhelp[0m: [1mOrganize imports[0m

[1m[91mF401 [0m[[1m[96m*[0m] [1m`app.models.document.Document` imported but unused[0m
  [1m[94m-->[0m tests/test_api_integration.py:20:33
   [1m[94m|[0m
[1m[94m18 |[0m from app.core.database import AsyncSessionLocal, get_engine, Base
[1m[94m19 |[0m from app.models.auth import User, MagicLinkToken
[1m[94m20 |[0m from app.models.document import Document
   [1m[94m|[0m                                 [1m[91m^^^^^^^^[0m
[1m[94m21 |[0m from app.services.auth_service import AuthService
[1m[94m22 |[0m from main import app  # noqa: E402
   [1m[94m|[0m
[1m[96mhelp[0m: [1mRemove unused import: `app.models.document.Document`[0m

[1m[91mF841 [0m[1mLocal variable `auth_service` is assigned to but never used[0m
  [1m[94m-->[0m tests/test_api_integration.py:72:5
   [1m[94m|[0m
[1m[94m70 |[0m async def auth_token(db_session, test_user):
[1m[94m71 |[0m     """Create auth token for test user using AuthService"""
[1m[94m72 |[0m     auth_service = AuthService(db_session)
   [1m[94m|[0m     [1m[91m^^^^^^^^^^^^[0m
[1m[94m73 |[0m     # Use the actual token creation method from AuthService
[1m[94m74 |[0m     from datetime import datetime, timedelta
   [1m[94m|[0m
[1m[96mhelp[0m: [1mRemove assignment to unused variable `auth_service`[0m

[1m[91mI001 [0m[[1m[96m*[0m] [1mImport block is un-sorted or un-formatted[0m
  [1m[94m-->[0m tests/test_api_integration.py:74:5
   [1m[94m|[0m
[1m[94m72 |[0m       auth_service = AuthService(db_session)
[1m[94m73 |[0m       # Use the actual token creation method from AuthService
[1m[94m74 |[0m [1m[91m/[0m     from datetime import datetime, timedelta
[1m[94m75 |[0m [1m[91m|[0m     from jose import jwt
[1m[94m76 |[0m [1m[91m|[0m     from app.core.config import settings
   [1m[94m|[0m [1m[91m|________________________________________^[0m
[1m[94m77 |[0m       
[1m[94m78 |[0m       secret_key = settings.JWT_SECRET or settings.SECRET_KEY
   [1m[94m|[0m
[1m[96mhelp[0m: [1mOrganize imports[0m

[1m[91mW293 [0m[[1m[96m*[0m] [1mBlank line contains whitespace[0m
  [1m[94m-->[0m tests/test_api_integration.py:77:1
   [1m[94m|[0m
[1m[94m75 |[0m     from jose import jwt
[1m[94m76 |[0m     from app.core.config import settings
[1m[94m77 |[0m     
   [1m[94m|[0m [1m[91m^^^^[0m
[1m[94m78 |[0m     secret_key = settings.JWT_SECRET or settings.SECRET_KEY
[1m[94m79 |[0m     expires_delta = timedelta(minutes=settings.JWT_EXP_MIN or 30)
   [1m[94m|[0m
[1m[96mhelp[0m: [1mRemove whitespace from blank line[0m

[1m[91mW293 [0m[[1m[96m*[0m] [1mBlank line contains whitespace[0m
  [1m[94m-->[0m tests/test_api_integration.py:81:1
   [1m[94m|[0m
[1m[94m79 |[0m     expires_delta = timedelta(minutes=settings.JWT_EXP_MIN or 30)
[1m[94m80 |[0m     expire = datetime.utcnow() + expires_delta
[1m[94m81 |[0m     
   [1m[94m|[0m [1m[91m^^^^[0m
[1m[94m82 |[0m     payload = {
[1m[94m83 |[0m         "sub": str(test_user.id),  # JWT sub claim should be string
   [1m[94m|[0m
[1m[96mhelp[0m: [1mRemove whitespace from blank line[0m

[1m[91mW293 [0m[[1m[96m*[0m] [1mBlank line contains whitespace[0m
  [1m[94m-->[0m tests/test_api_integration.py:93:1
   [1m[94m|[0m
[1m[94m91 |[0m     if settings.JWT_AUD:
[1m[94m92 |[0m         payload["aud"] = settings.JWT_AUD
[1m[94m93 |[0m     
   [1m[94m|[0m [1m[91m^^^^[0m
[1m[94m94 |[0m     token = jwt.encode(payload, secret_key, algorithm=settings.JWT_ALG)
[1m[94m95 |[0m     return token
   [1m[94m|[0m
[1m[96mhelp[0m: [1mRemove whitespace from blank line[0m

[1m[91mW293 [0m[[1m[96m*[0m] [1mBlank line contains whitespace[0m
   [1m[94m-->[0m tests/test_api_integration.py:108:1
    [1m[94m|[0m
[1m[94m106 |[0m     # Magic link might return 403 if rate limited, or 200 if successful
[1m[94m107 |[0m     assert response.status_code in [200, 403]
[1m[94m108 |[0m     
    [1m[94m|[0m [1m[91m^^^^[0m
[1m[94m109 |[0m     if response.status_code == 200:
[1m[94m110 |[0m         data = response.json()
    [1m[94m|[0m
[1m[96mhelp[0m: [1mRemove whitespace from blank line[0m

[1m[91mW293 [0m[[1m[96m*[0m] [1mBlank line contains whitespace[0m
   [1m[94m-->[0m tests/test_api_integration.py:121:1
    [1m[94m|[0m
[1m[94m119 |[0m         )
[1m[94m120 |[0m         magic_token = token_result.scalar_one_or_none()
[1m[94m121 |[0m         
    [1m[94m|[0m [1m[91m^^^^^^^^[0m
[1m[94m122 |[0m         if magic_token:
[1m[94m123 |[0m             # Step 3: Verify magic link
    [1m[94m|[0m
[1m[96mhelp[0m: [1mRemove whitespace from blank line[0m

[1m[91mW293 [0m[[1m[96m*[0m] [1mBlank line contains whitespace[0m
   [1m[94m-->[0m tests/test_api_integration.py:163:1
    [1m[94m|[0m
[1m[94m161 |[0m     # Check response status
[1m[94m162 |[0m     assert create_response.status_code in [200, 201], f"Expected 200/201, got {create_response.status_code}: {create_response.text}"
[1m[94m163 |[0m     
    [1m[94m|[0m [1m[91m^^^^[0m
[1m[94m164 |[0m     if create_response.status_code in [200, 201]:
[1m[94m165 |[0m         create_data = create_response.json()
    [1m[94m|[0m
[1m[96mhelp[0m: [1mRemove whitespace from blank line[0m

[1m[91mW293 [0m[[1m[96m*[0m] [1mBlank line contains whitespace[0m
   [1m[94m-->[0m tests/test_api_integration.py:174:1
    [1m[94m|[0m
[1m[94m172 |[0m         else:
[1m[94m173 |[0m             pytest.skip("Could not extract document ID from response")
[1m[94m174 |[0m         
    [1m[94m|[0m [1m[91m^^^^^^^^[0m
[1m[94m175 |[0m         assert document_id is not None, "Document ID should be present"
    [1m[94m|[0m
[1m[96mhelp[0m: [1mRemove whitespace from blank line[0m

[1m[91mW293 [0m[[1m[96m*[0m] [1mBlank line contains whitespace[0m
   [1m[94m-->[0m tests/test_api_integration.py:176:1
    [1m[94m|[0m
[1m[94m175 |[0m         assert document_id is not None, "Document ID should be present"
[1m[94m176 |[0m         
    [1m[94m|[0m [1m[91m^^^^^^^^[0m
[1m[94m177 |[0m         # Step 2: Get document
[1m[94m178 |[0m         get_response = await client.get(
    [1m[94m|[0m
[1m[96mhelp[0m: [1mRemove whitespace from blank line[0m

[1m[91mI001 [0m[[1m[96m*[0m] [1mImport block is un-sorted or un-formatted[0m
  [1m[94m-->[0m tests/test_api_integration_simple.py:18:1
   [1m[94m|[0m
[1m[94m16 |[0m   os.environ.setdefault("DISABLE_RATE_LIMIT", "true")
[1m[94m17 |[0m
[1m[94m18 |[0m [1m[91m/[0m from app.core.database import AsyncSessionLocal, get_engine, Base
[1m[94m19 |[0m [1m[91m|[0m from app.models.auth import User
[1m[94m20 |[0m [1m[91m|[0m from app.services.auth_service import AuthService
[1m[94m21 |[0m [1m[91m|[0m from main import app  # noqa: E402
   [1m[94m|[0m [1m[91m|____________________^[0m
   [1m[94m|[0m
[1m[96mhelp[0m: [1mOrganize imports[0m

[1m[91mF401 [0m[[1m[96m*[0m] [1m`app.services.auth_service.AuthService` imported but unused[0m
  [1m[94m-->[0m tests/test_api_integration_simple.py:20:39
   [1m[94m|[0m
[1m[94m18 |[0m from app.core.database import AsyncSessionLocal, get_engine, Base
[1m[94m19 |[0m from app.models.auth import User
[1m[94m20 |[0m from app.services.auth_service import AuthService
   [1m[94m|[0m                                       [1m[91m^^^^^^^^^^^[0m
[1m[94m21 |[0m from main import app  # noqa: E402
   [1m[94m|[0m
[1m[96mhelp[0m: [1mRemove unused import: `app.services.auth_service.AuthService`[0m

[1m[91mI001 [0m[[1m[96m*[0m] [1mImport block is un-sorted or un-formatted[0m
  [1m[94m-->[0m tests/test_api_integration_simple.py:65:5
   [1m[94m|[0m
[1m[94m63 |[0m   async def auth_token(db_session, test_user):
[1m[94m64 |[0m       """Create auth token for test user using AuthService"""
[1m[94m65 |[0m [1m[91m/[0m     from datetime import datetime, timedelta
[1m[94m66 |[0m [1m[91m|[0m     from jose import jwt
[1m[94m67 |[0m [1m[91m|[0m     from app.core.config import settings
   [1m[94m|[0m [1m[91m|________________________________________^[0m
[1m[94m68 |[0m       
[1m[94m69 |[0m       # Use the same secret that AuthService uses
   [1m[94m|[0m
[1m[96mhelp[0m: [1mOrganize imports[0m

[1m[91mW293 [0m[[1m[96m*[0m] [1mBlank line contains whitespace[0m
  [1m[94m-->[0m tests/test_api_integration_simple.py:68:1
   [1m[94m|[0m
[1m[94m66 |[0m     from jose import jwt
[1m[94m67 |[0m     from app.core.config import settings
[1m[94m68 |[0m     
   [1m[94m|[0m [1m[91m^^^^[0m
[1m[94m69 |[0m     # Use the same secret that AuthService uses
[1m[94m70 |[0m     secret_key = settings.JWT_SECRET if hasattr(settings, 'JWT_SECRET') and settings.JWT_SECRET else settings.SECRET_KEY
   [1m[94m|[0m
[1m[96mhelp[0m: [1mRemove whitespace from blank line[0m

[1m[91mW293 [0m[[1m[96m*[0m] [1mBlank line contains whitespace[0m
  [1m[94m-->[0m tests/test_api_integration_simple.py:74:1
   [1m[94m|[0m
[1m[94m72 |[0m     expires_delta = timedelta(minutes=30)
[1m[94m73 |[0m     expire = datetime.utcnow() + expires_delta
[1m[94m74 |[0m     
   [1m[94m|[0m [1m[91m^^^^[0m
[1m[94m75 |[0m     # Create payload exactly as AuthService expects
[1m[94m76 |[0m     payload = {
   [1m[94m|[0m
[1m[96mhelp[0m: [1mRemove whitespace from blank line[0m

[1m[91mW293 [0m[[1m[96m*[0m] [1mBlank line contains whitespace[0m
  [1m[94m-->[0m tests/test_api_integration_simple.py:83:1
   [1m[94m|[0m
[1m[94m81 |[0m         "nbf": datetime.utcnow(),
[1m[94m82 |[0m     }
[1m[94m83 |[0m     
   [1m[94m|[0m [1m[91m^^^^[0m
[1m[94m84 |[0m     # Add issuer/audience if configured
[1m[94m85 |[0m     if hasattr(settings, 'JWT_ISS') and settings.JWT_ISS:
   [1m[94m|[0m
[1m[96mhelp[0m: [1mRemove whitespace from blank line[0m

[1m[91mW293 [0m[[1m[96m*[0m] [1mBlank line contains whitespace[0m
  [1m[94m-->[0m tests/test_api_integration_simple.py:89:1
   [1m[94m|[0m
[1m[94m87 |[0m     if hasattr(settings, 'JWT_AUD') and settings.JWT_AUD:
[1m[94m88 |[0m         payload["aud"] = settings.JWT_AUD
[1m[94m89 |[0m     
   [1m[94m|[0m [1m[91m^^^^[0m
[1m[94m90 |[0m     token = jwt.encode(payload, secret_key, algorithm=algorithm)
[1m[94m91 |[0m     return token
   [1m[94m|[0m
[1m[96mhelp[0m: [1mRemove whitespace from blank line[0m

[1m[91mW293 [0m[[1m[96m*[0m] [1mBlank line contains whitespace[0m
   [1m[94m-->[0m tests/test_api_integration_simple.py:120:1
    [1m[94m|[0m
[1m[94m118 |[0m         headers={"Authorization": f"Bearer {auth_token}"}
[1m[94m119 |[0m     )
[1m[94m120 |[0m     
    [1m[94m|[0m [1m[91m^^^^[0m
[1m[94m121 |[0m     # The endpoint uses AuthService.get_current_user which expects JWT token
[1m[94m122 |[0m     # It should work if token is valid
    [1m[94m|[0m
[1m[96mhelp[0m: [1mRemove whitespace from blank line[0m

[1m[91mW293 [0m[[1m[96m*[0m] [1mBlank line contains whitespace[0m
   [1m[94m-->[0m tests/test_api_integration_simple.py:124:1
    [1m[94m|[0m
[1m[94m122 |[0m     # It should work if token is valid
[1m[94m123 |[0m     assert response.status_code in [200, 401]
[1m[94m124 |[0m     
    [1m[94m|[0m [1m[91m^^^^[0m
[1m[94m125 |[0m     if response.status_code == 200:
[1m[94m126 |[0m         data = response.json()
    [1m[94m|[0m
[1m[96mhelp[0m: [1mRemove whitespace from blank line[0m

[1m[91mW293 [0m[[1m[96m*[0m] [1mBlank line contains whitespace[0m
   [1m[94m-->[0m tests/test_api_integration_simple.py:156:1
    [1m[94m|[0m
[1m[94m154 |[0m     # Should either succeed (200/201) or require different auth (401/403)
[1m[94m155 |[0m     assert response.status_code in [200, 201, 401, 403]
[1m[94m156 |[0m     
    [1m[94m|[0m [1m[91m^^^^[0m
[1m[94m157 |[0m     if response.status_code in [200, 201]:
[1m[94m158 |[0m         data = response.json()
    [1m[94m|[0m
[1m[96mhelp[0m: [1mRemove whitespace from blank line[0m

[1m[91mW293 [0m[[1m[96m*[0m] [1mBlank line contains whitespace[0m
   [1m[94m-->[0m tests/test_api_integration_simple.py:171:1
    [1m[94m|[0m
[1m[94m169 |[0m     # Should either return stats (200) or require auth (401)
[1m[94m170 |[0m     assert response.status_code in [200, 401, 403]
[1m[94m171 |[0m     
    [1m[94m|[0m [1m[91m^^^^[0m
[1m[94m172 |[0m     if response.status_code == 200:
[1m[94m173 |[0m         data = response.json()
    [1m[94m|[0m
[1m[96mhelp[0m: [1mRemove whitespace from blank line[0m

[1m[91mI001 [0m[[1m[96m*[0m] [1mImport block is un-sorted or un-formatted[0m
  [1m[94m-->[0m tests/test_auth_service_extended.py:4:1
   [1m[94m|[0m
[1m[94m 2 |[0m   Extended tests for AuthService to improve coverage
[1m[94m 3 |[0m   """
[1m[94m 4 |[0m [1m[91m/[0m import pytest
[1m[94m 5 |[0m [1m[91m|[0m from datetime import datetime, timedelta
[1m[94m 6 |[0m [1m[91m|[0m from unittest.mock import AsyncMock, patch
[1m[94m 7 |[0m [1m[91m|[0m
[1m[94m 8 |[0m [1m[91m|[0m from app.core.exceptions import AuthenticationError, ValidationError
[1m[94m 9 |[0m [1m[91m|[0m from app.models.auth import User, MagicLinkToken
[1m[94m10 |[0m [1m[91m|[0m from app.services.auth_service import AuthService
   [1m[94m|[0m [1m[91m|_________________________________________________^[0m
   [1m[94m|[0m
[1m[96mhelp[0m: [1mOrganize imports[0m

[1m[91mF401 [0m[[1m[96m*[0m] [1m`unittest.mock.AsyncMock` imported but unused[0m
 [1m[94m-->[0m tests/test_auth_service_extended.py:6:27
  [1m[94m|[0m
[1m[94m4 |[0m import pytest
[1m[94m5 |[0m from datetime import datetime, timedelta
[1m[94m6 |[0m from unittest.mock import AsyncMock, patch
  [1m[94m|[0m                           [1m[91m^^^^^^^^^[0m
[1m[94m7 |[0m
[1m[94m8 |[0m from app.core.exceptions import AuthenticationError, ValidationError
  [1m[94m|[0m
[1m[96mhelp[0m: [1mRemove unused import[0m

[1m[91mF401 [0m[[1m[96m*[0m] [1m`unittest.mock.patch` imported but unused[0m
 [1m[94m-->[0m tests/test_auth_service_extended.py:6:38
  [1m[94m|[0m
[1m[94m4 |[0m import pytest
[1m[94m5 |[0m from datetime import datetime, timedelta
[1m[94m6 |[0m from unittest.mock import AsyncMock, patch
  [1m[94m|[0m                                      [1m[91m^^^^^[0m
[1m[94m7 |[0m
[1m[94m8 |[0m from app.core.exceptions import AuthenticationError, ValidationError
  [1m[94m|[0m
[1m[96mhelp[0m: [1mRemove unused import[0m

[1m[91mW293 [0m[[1m[96m*[0m] [1mBlank line contains whitespace[0m
  [1m[94m-->[0m tests/test_auth_service_extended.py:17:1
   [1m[94m|[0m
[1m[94m15 |[0m     """Test sending magic link to new user (creates user)"""
[1m[94m16 |[0m     service = AuthService(db_session)
[1m[94m17 |[0m     
   [1m[94m|[0m [1m[91m^^^^[0m
[1m[94m18 |[0m     result = await service.send_magic_link("newuser@example.com")
   [1m[94m|[0m
[1m[96mhelp[0m: [1mRemove whitespace from blank line[0m

[1m[91mW293 [0m[[1m[96m*[0m] [1mBlank line contains whitespace[0m
  [1m[94m-->[0m tests/test_auth_service_extended.py:19:1
   [1m[94m|[0m
[1m[94m18 |[0m     result = await service.send_magic_link("newuser@example.com")
[1m[94m19 |[0m     
   [1m[94m|[0m [1m[91m^^^^[0m
[1m[94m20 |[0m     assert "message" in result
[1m[94m21 |[0m     assert result["email"] == "newuser@example.com"
   [1m[94m|[0m
[1m[96mhelp[0m: [1mRemove whitespace from blank line[0m

[1m[91mW293 [0m[[1m[96m*[0m] [1mBlank line contains whitespace[0m
  [1m[94m-->[0m tests/test_auth_service_extended.py:22:1
   [1m[94m|[0m
[1m[94m20 |[0m     assert "message" in result
[1m[94m21 |[0m     assert result["email"] == "newuser@example.com"
[1m[94m22 |[0m     
   [1m[94m|[0m [1m[91m^^^^[0m
[1m[94m23 |[0m     # Verify user was created
[1m[94m24 |[0m     from sqlalchemy import select
   [1m[94m|[0m
[1m[96mhelp[0m: [1mRemove whitespace from blank line[0m

[1m[91mW293 [0m[[1m[96m*[0m] [1mBlank line contains whitespace[0m
  [1m[94m-->[0m tests/test_auth_service_extended.py:41:1
   [1m[94m|[0m
[1m[94m40 |[0m     service = AuthService(db_session)
[1m[94m41 |[0m     
   [1m[94m|[0m [1m[91m^^^^[0m
[1m[94m42 |[0m     result = await service.send_magic_link("existing@example.com")
   [1m[94m|[0m
[1m[96mhelp[0m: [1mRemove whitespace from blank line[0m

[1m[91mW293 [0m[[1m[96m*[0m] [1mBlank line contains whitespace[0m
  [1m[94m-->[0m tests/test_auth_service_extended.py:43:1
   [1m[94m|[0m
[1m[94m42 |[0m     result = await service.send_magic_link("existing@example.com")
[1m[94m43 |[0m     
   [1m[94m|[0m [1m[91m^^^^[0m
[1m[94m44 |[0m     assert "message" in result
[1m[94m45 |[0m     assert result["email"] == "existing@example.com"
   [1m[94m|[0m
[1m[96mhelp[0m: [1mRemove whitespace from blank line[0m

[1m[91mW293 [0m[[1m[96m*[0m] [1mBlank line contains whitespace[0m
  [1m[94m-->[0m tests/test_auth_service_extended.py:52:1
   [1m[94m|[0m
[1m[94m50 |[0m     """Test sending magic link with invalid email"""
[1m[94m51 |[0m     service = AuthService(db_session)
[1m[94m52 |[0m     
   [1m[94m|[0m [1m[91m^^^^[0m
[1m[94m53 |[0m     with pytest.raises((ValidationError, AuthenticationError)):
[1m[94m54 |[0m         await service.send_magic_link("invalid-email")
   [1m[94m|[0m
[1m[96mhelp[0m: [1mRemove whitespace from blank line[0m

[1m[91mW293 [0m[[1m[96m*[0m] [1mBlank line contains whitespace[0m
  [1m[94m-->[0m tests/test_auth_service_extended.py:79:1
   [1m[94m|[0m
[1m[94m78 |[0m     service = AuthService(db_session)
[1m[94m79 |[0m     
   [1m[94m|[0m [1m[91m^^^^[0m
[1m[94m80 |[0m     result = await service.verify_magic_link(token)
   [1m[94m|[0m
[1m[96mhelp[0m: [1mRemove whitespace from blank line[0m

[1m[91mW293 [0m[[1m[96m*[0m] [1mBlank line contains whitespace[0m
  [1m[94m-->[0m tests/test_auth_service_extended.py:81:1
   [1m[94m|[0m
[1m[94m80 |[0m     result = await service.verify_magic_link(token)
[1m[94m81 |[0m     
   [1m[94m|[0m [1m[91m^^^^[0m
[1m[94m82 |[0m     assert "access_token" in result
[1m[94m83 |[0m     assert "user" in result
   [1m[94m|[0m
[1m[96mhelp[0m: [1mRemove whitespace from blank line[0m

[1m[91mW293 [0m[[1m[96m*[0m] [1mBlank line contains whitespace[0m
  [1m[94m-->[0m tests/test_auth_service_extended.py:84:1
   [1m[94m|[0m
[1m[94m82 |[0m     assert "access_token" in result
[1m[94m83 |[0m     assert "user" in result
[1m[94m84 |[0m     
   [1m[94m|[0m [1m[91m^^^^[0m
[1m[94m85 |[0m     # Verify token was marked as used
[1m[94m86 |[0m     await db_session.refresh(magic_token)
   [1m[94m|[0m
[1m[96mhelp[0m: [1mRemove whitespace from blank line[0m

[1m[91mW293 [0m[[1m[96m*[0m] [1mBlank line contains whitespace[0m
  [1m[94m-->[0m tests/test_auth_service_extended.py:94:1
   [1m[94m|[0m
[1m[94m92 |[0m     """Test verifying invalid magic link token"""
[1m[94m93 |[0m     service = AuthService(db_session)
[1m[94m94 |[0m     
   [1m[94m|[0m [1m[91m^^^^[0m
[1m[94m95 |[0m     with pytest.raises(AuthenticationError, match="Invalid or expired magic link"):
[1m[94m96 |[0m         await service.verify_magic_link("invalid-token")
   [1m[94m|[0m
[1m[96mhelp[0m: [1mRemove whitespace from blank line[0m

[1m[91mW293 [0m[[1m[96m*[0m] [1mBlank line contains whitespace[0m
   [1m[94m-->[0m tests/test_auth_service_extended.py:115:1
    [1m[94m|[0m
[1m[94m114 |[0m     service = AuthService(db_session)
[1m[94m115 |[0m     
    [1m[94m|[0m [1m[91m^^^^[0m
[1m[94m116 |[0m     with pytest.raises(AuthenticationError, match="Invalid or expired magic link"):
[1m[94m117 |[0m         await service.verify_magic_link(token)
    [1m[94m|[0m
[1m[96mhelp[0m: [1mRemove whitespace from blank line[0m

[1m[91mW293 [0m[[1m[96m*[0m] [1mBlank line contains whitespace[0m
   [1m[94m-->[0m tests/test_auth_service_extended.py:137:1
    [1m[94m|[0m
[1m[94m136 |[0m     service = AuthService(db_session)
[1m[94m137 |[0m     
    [1m[94m|[0m [1m[91m^^^^[0m
[1m[94m138 |[0m     with pytest.raises(AuthenticationError, match="Invalid or expired magic link"):
[1m[94m139 |[0m         await service.verify_magic_link(token)
    [1m[94m|[0m
[1m[96mhelp[0m: [1mRemove whitespace from blank line[0m

[1m[91mW293 [0m[[1m[96m*[0m] [1mBlank line contains whitespace[0m
   [1m[94m-->[0m tests/test_auth_service_extended.py:146:1
    [1m[94m|[0m
[1m[94m144 |[0m     """Test getting current user with invalid token"""
[1m[94m145 |[0m     service = AuthService(db_session)
[1m[94m146 |[0m     
    [1m[94m|[0m [1m[91m^^^^[0m
[1m[94m147 |[0m     with pytest.raises(AuthenticationError):
[1m[94m148 |[0m         await service.get_current_user("invalid-token")
    [1m[94m|[0m
[1m[96mhelp[0m: [1mRemove whitespace from blank line[0m

[1m[91mI001 [0m[[1m[96m*[0m] [1mImport block is un-sorted or un-formatted[0m
   [1m[94m-->[0m tests/test_auth_service_extended.py:154:5
    [1m[94m|[0m
[1m[94m152 |[0m   async def test_get_current_user_user_not_found(db_session):
[1m[94m153 |[0m       """Test getting current user when user doesn't exist"""
[1m[94m154 |[0m [1m[91m/[0m     from datetime import datetime, timedelta
[1m[94m155 |[0m [1m[91m|[0m     from jose import jwt
[1m[94m156 |[0m [1m[91m|[0m     from app.core.config import settings
    [1m[94m|[0m [1m[91m|________________________________________^[0m
[1m[94m157 |[0m       
[1m[94m158 |[0m       # Create token for non-existent user
    [1m[94m|[0m
[1m[96mhelp[0m: [1mOrganize imports[0m

[1m[91mW293 [0m[[1m[96m*[0m] [1mBlank line contains whitespace[0m
   [1m[94m-->[0m tests/test_auth_service_extended.py:157:1
    [1m[94m|[0m
[1m[94m155 |[0m     from jose import jwt
[1m[94m156 |[0m     from app.core.config import settings
[1m[94m157 |[0m     
    [1m[94m|[0m [1m[91m^^^^[0m
[1m[94m158 |[0m     # Create token for non-existent user
[1m[94m159 |[0m     secret_key = settings.JWT_SECRET or settings.SECRET_KEY
    [1m[94m|[0m
[1m[96mhelp[0m: [1mRemove whitespace from blank line[0m

[1m[91mW293 [0m[[1m[96m*[0m] [1mBlank line contains whitespace[0m
   [1m[94m-->[0m tests/test_auth_service_extended.py:168:1
    [1m[94m|[0m
[1m[94m166 |[0m     }
[1m[94m167 |[0m     token = jwt.encode(payload, secret_key, algorithm="HS256")
[1m[94m168 |[0m     
    [1m[94m|[0m [1m[91m^^^^[0m
[1m[94m169 |[0m     service = AuthService(db_session)
    [1m[94m|[0m
[1m[96mhelp[0m: [1mRemove whitespace from blank line[0m

[1m[91mW293 [0m[[1m[96m*[0m] [1mBlank line contains whitespace[0m
   [1m[94m-->[0m tests/test_auth_service_extended.py:170:1
    [1m[94m|[0m
[1m[94m169 |[0m     service = AuthService(db_session)
[1m[94m170 |[0m     
    [1m[94m|[0m [1m[91m^^^^[0m
[1m[94m171 |[0m     with pytest.raises(AuthenticationError, match="User not found or inactive"):
[1m[94m172 |[0m         await service.get_current_user(token)
    [1m[94m|[0m
[1m[96mhelp[0m: [1mRemove whitespace from blank line[0m

[1m[91mI001 [0m[[1m[96m*[0m] [1mImport block is un-sorted or un-formatted[0m
   [1m[94m-->[0m tests/test_auth_service_extended.py:184:5
    [1m[94m|[0m
[1m[94m182 |[0m       await db_session.refresh(user)
[1m[94m183 |[0m
[1m[94m184 |[0m [1m[91m/[0m     from datetime import datetime, timedelta
[1m[94m185 |[0m [1m[91m|[0m     from jose import jwt
[1m[94m186 |[0m [1m[91m|[0m     from app.core.config import settings
    [1m[94m|[0m [1m[91m|________________________________________^[0m
[1m[94m187 |[0m       
[1m[94m188 |[0m       # Create token for inactive user
    [1m[94m|[0m
[1m[96mhelp[0m: [1mOrganize imports[0m

[1m[91mW293 [0m[[1m[96m*[0m] [1mBlank line contains whitespace[0m
   [1m[94m-->[0m tests/test_auth_service_extended.py:187:1
    [1m[94m|[0m
[1m[94m185 |[0m     from jose import jwt
[1m[94m186 |[0m     from app.core.config import settings
[1m[94m187 |[0m     
    [1m[94m|[0m [1m[91m^^^^[0m
[1m[94m188 |[0m     # Create token for inactive user
[1m[94m189 |[0m     secret_key = settings.JWT_SECRET or settings.SECRET_KEY
    [1m[94m|[0m
[1m[96mhelp[0m: [1mRemove whitespace from blank line[0m

[1m[91mW293 [0m[[1m[96m*[0m] [1mBlank line contains whitespace[0m
   [1m[94m-->[0m tests/test_auth_service_extended.py:198:1
    [1m[94m|[0m
[1m[94m196 |[0m     }
[1m[94m197 |[0m     token = jwt.encode(payload, secret_key, algorithm="HS256")
[1m[94m198 |[0m     
    [1m[94m|[0m [1m[91m^^^^[0m
[1m[94m199 |[0m     service = AuthService(db_session)
    [1m[94m|[0m
[1m[96mhelp[0m: [1mRemove whitespace from blank line[0m

[1m[91mW293 [0m[[1m[96m*[0m] [1mBlank line contains whitespace[0m
   [1m[94m-->[0m tests/test_auth_service_extended.py:200:1
    [1m[94m|[0m
[1m[94m199 |[0m     service = AuthService(db_session)
[1m[94m200 |[0m     
    [1m[94m|[0m [1m[91m^^^^[0m
[1m[94m201 |[0m     with pytest.raises(AuthenticationError, match="User not found or inactive"):
[1m[94m202 |[0m         await service.get_current_user(token)
    [1m[94m|[0m
[1m[96mhelp[0m: [1mRemove whitespace from blank line[0m

[1m[91mW293 [0m[[1m[96m*[0m] [1mBlank line contains whitespace[0m
  [1m[94m-->[0m tests/test_document_service.py:97:1
   [1m[94m|[0m
[1m[94m95 |[0m     # Create service and try to get non-existent document
[1m[94m96 |[0m     service = DocumentService(db_session)
[1m[94m97 |[0m     
   [1m[94m|[0m [1m[91m^^^^[0m
[1m[94m98 |[0m     with pytest.raises(NotFoundError, match="Document not found"):
[1m[94m99 |[0m         await service.get_document(document_id=999, user_id=user.id)
   [1m[94m|[0m
[1m[96mhelp[0m: [1mRemove whitespace from blank line[0m

[1m[91mW293 [0m[[1m[96m*[0m] [1mBlank line contains whitespace[0m
   [1m[94m-->[0m tests/test_document_service.py:305:1
    [1m[94m|[0m
[1m[94m304 |[0m     service = DocumentService(db_session)
[1m[94m305 |[0m     
    [1m[94m|[0m [1m[91m^^^^[0m
[1m[94m306 |[0m     with pytest.raises(NotFoundError):
[1m[94m307 |[0m         await service.update_document(
    [1m[94m|[0m
[1m[96mhelp[0m: [1mRemove whitespace from blank line[0m

[1m[91mW293 [0m[[1m[96m*[0m] [1mBlank line contains whitespace[0m
   [1m[94m-->[0m tests/test_document_service.py:323:1
    [1m[94m|[0m
[1m[94m322 |[0m     service = DocumentService(db_session)
[1m[94m323 |[0m     
    [1m[94m|[0m [1m[91m^^^^[0m
[1m[94m324 |[0m     with pytest.raises((NotFoundError, ValidationError)):  # Can raise NotFoundError or ValidationError
[1m[94m325 |[0m         await service.delete_document(document_id=999, user_id=user.id)
    [1m[94m|[0m
[1m[96mhelp[0m: [1mRemove whitespace from blank line[0m

[1m[91mW293 [0m[[1m[96m*[0m] [1mBlank line contains whitespace[0m
   [1m[94m-->[0m tests/test_document_service.py:337:1
    [1m[94m|[0m
[1m[94m336 |[0m     service = DocumentService(db_session)
[1m[94m337 |[0m     
    [1m[94m|[0m [1m[91m^^^^[0m
[1m[94m338 |[0m     with pytest.raises(NotFoundError):
[1m[94m339 |[0m         await service.get_document_sections(document_id=999, user_id=user.id)
    [1m[94m|[0m
[1m[96mhelp[0m: [1mRemove whitespace from blank line[0m

[1m[91mF401 [0m[[1m[96m*[0m] [1m`app.core.exceptions.NotFoundError` imported but unused[0m
 [1m[94m-->[0m tests/test_document_service_extended.py:6:33
  [1m[94m|[0m
[1m[94m4 |[0m import pytest
[1m[94m5 |[0m
[1m[94m6 |[0m from app.core.exceptions import NotFoundError, ValidationError
  [1m[94m|[0m                                 [1m[91m^^^^^^^^^^^^^[0m
[1m[94m7 |[0m from app.models.auth import User
[1m[94m8 |[0m from app.models.document import Document, DocumentSection
  [1m[94m|[0m
[1m[96mhelp[0m: [1mRemove unused import[0m

[1m[91mF401 [0m[[1m[96m*[0m] [1m`app.core.exceptions.ValidationError` imported but unused[0m
 [1m[94m-->[0m tests/test_document_service_extended.py:6:48
  [1m[94m|[0m
[1m[94m4 |[0m import pytest
[1m[94m5 |[0m
[1m[94m6 |[0m from app.core.exceptions import NotFoundError, ValidationError
  [1m[94m|[0m                                                [1m[91m^^^^^^^^^^^^^^^[0m
[1m[94m7 |[0m from app.models.auth import User
[1m[94m8 |[0m from app.models.document import Document, DocumentSection
  [1m[94m|[0m
[1m[96mhelp[0m: [1mRemove unused import[0m

Found 86 errors.
[[36m*[0m] 80 fixable with the `--fix` option (6 hidden fixes can be enabled with the `--unsafe-fixes` option).
